<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html>
    <head>
        <meta name="generator" content="HTML Tidy, see www.w3.org">
		<style type="text/css">
p.padding
{
/*
padding-top:50px;
*/
padding-bottom:25px;
/*
padding-right:50px;
*/
position:absolute;
top:350px;
padding-left:950px;
}
</style>
        <title>Tag Profile View</title>
    </head>

    <body>
        #{extends 'main.html' /}
		#{set title: 'Tag Profile' /}
		#{if flash.success}
		<p style="color:#00ff40">
			${flash.success}
			</p>
		</style>
		#{/if}
		#{if flash.error}
		<p style="color:#ff0000">
			${flash.error}
			</p>
		</style>
		#{/if}
		#{if follower == true}
			 <form onsubmit="unfollow('${tag.id}');" method="post">
			<p>
			Unfollow ${tag.name} <input type="submit" value="unfollow" />
			</p>	
			</form>
		#{/if} 
		#{if follower == false}
			 <form onsubmit="follow('${tag.id}', '${user.id}');" method="post">
			<p>
			Follow ${tag.name} <input type="submit" value="follow" />
			</p>	
			</form>
		#{/if}		 
		#{if allowed}
		<form action="@{Tags.edit()}" method="post">
			<p>
			<input type="hidden" id="tagId" name="tagId" value="${tag.id}" />Edit Tag Name
			<input type="text" id="name" name="name" value="${tag.name}" /> 
                <input type="submit" value="Edit" />
            </p>
		</form>
		<br />
		<form action="@{Tags.delete()}" method="post">
			<p>
			<input type="hidden" id="tagId" name="tagId" value="${tag.id}" />Delete Tag 
                <input type="submit" value="Delete" />
            </p>
		</form>
		#{/if}
		
		#{if canCreateRelationship == true}
		<p><b>
			<a href="@{Tags.createRelation(tag.id,tag.createdInOrganization.id)}">create relation</a>
		</b></p>
		#{/if}
		
		<script type="text/javascript">
   	function showRename(relId)
	{
	var newRelName = prompt("Please enter the new name:", document.getElementById(relId).textContent);
	location.reload();
	if (newRelName!=null && newRelName!="")
  	{
  	$.post('@{TagRelationships.renameRelationship()}', {
		relationToBeRenamedId: relId,
		newName: newRelName
	});
	
  	}
	}
   </script>
		
		<a onclick="$('#lista').slideToggle();">Show Relationships</a>
	<div id="lista" style="display:none;">
		#{if tag.relationsSource != null}
		#{list items:tag.relationsSource, as:'relationElement'}
				<ul>Name: <a id="relationElement.id">${relationElement.name}</a> With: <a href="/tags/mainpage?tagId=${relationElement.destination.id}">${relationElement.destination.name}</a> <input type="button" value="rename" onclick="showRename(${relationElement.id})"/> <input type="button" value="end relationship" onclick="endRelation(${relationElement.id})" /></ul>
		#{/list}
		#{/if}
		#{if tag.relationsDestination != null}
		#{list items:tag.relationsDestination, as:'relElement'}
				<ul>Name: <a id="relElement,id">${relElement.name}</a> With: <a href="/tags/mainpage?tagId=${relElement.source.id}">${relElement.source.name}</a> <input type="button" value="rename" onclick="showRename(${relElement.id})"/> <input type="button" value="end relationship" onclick="endRelation(${relElement.id})" /></ul>
		#{/list}
		#{/if}
	</div>
		
        <center><big><b>${tag.name}</b></big></center><br><br>
		List of Followers:
		<br>
		
		#{list items:followers, as:'follower'}
		<li>
			${follower.username}
		</li>
		#{/list}
		<br>
		List of tagged Topics:
		<br>
		#{list items:topics, as:'topic'}
		<li>
			<a href="@{Topics.show(topic.id)}">${topic.title}</a>
		</li>
		#{/list}
		<br>
		List of tagged Organizations:
		<br>
		#{list items:organizations, as:'organization'}
		<li>
			<a href="@{Organizations.viewProfile(organization.id)}">${organization.name}</a>
		</li>
		#{/list}
		<br>
		List of tagged Entities:
		<br>
		#{list items:entities, as:'entity'}
		<li>
			<a href="@{MainEntitys.viewEntity(entity.id)}">${entity.name} ${entity.organization}</a>
		</li>
		#{/list}
		<br>
		List of tagged Ideas:
		<br>
		#{list items:ideas, as:'idea'}
		<li>
			<a href="@{Ideas.show(idea.id)}">${idea.title}</a>
		</li>
		#{/list}
		
	
	
	<!--	<b>
			<a onclick="@{Users.followTag(tag.id)}" href="/organizations/viewprofile?id=${tag.createdInOrganization.id}">Follow</a>
		</b>
		<script type="text/javascript">
			alert("you are now following " + tag);
		</script>   -->

		<script type="text/javascript">
			
			function endRelation(relId){
				$.post('@{TagRelationships.delete()}', {relationId: relId});
				alert("relation deleted succesfully!");
				window.location.reload();
			}
			
			function unfollow(id){
		$.post('@{Users.unfollowTag()}', {
			tagId: id
		});
		alert("done!");
		location.reload(true);
	}
	function follow(id, user){
		$.post('@{Users.followTag()}', {
			tagId: id, userId:user
		});
		alert("done!");
		location.reload(true);
	}
		</script>
		

    </body>
</html>

