#{extends 'main.html' /}
#{set title:'View list of assigned items' /}
#{if assignedItems.size() > 0}<h3>Assigned Items </h3>
<ul style="list-style: none; ">
    #{list items:assignedItems, as:'assignedItem'}
    <li>
        <fieldset>
            <legend>
            	
				<h2>Plan: <a href="@{Plans.viewAsList(assignedItem.plan.id)}">${assignedItem.plan.title}</a></h2>
               
            </legend>
            Title: ${item.summary} &nbsp; &nbsp; &nbsp;
			#{if assignedItem.endDate.compareTo(new Date()) >= 0}
            #{if assignedItem.status == 0} 
			<input type = "button" value="Start" onClick ="startItem('${assignedItem.id}');"/> 
			#{/if}
            #{else}
			<input type="checkbox" onClick="toggle_task('${assignedItem.id}');" ${assignedItem.status == 1 ? '':'checked'} />
			#{/if}
			#{if assignedItem.status == 1}
			in progress
			#{/if}
			#{else}
			done
			#{/else}
			#{/else}
			<br/>
            Item Description: ${assignedItem.description}
            <br/>
            Start Date:  ${assignedItem.startDate.format('dd MMM yy')}
            <br/>
            End Date:  ${assignedItem.endtDate.format('dd MMM yy')}
            <br/>
            Assigned Users: 
            <ul style="list-style: none; ">
                #{list users:${assignedItem.assignees}, as:'assignedUser'}
                <li>
                    <a href="#">${assignedUser.username}</a>
                </li>
                #{/list}
            </ul>
        </fieldset>
    </li>
    #{/list}
</ul>
#{/if}
#{else}
You are not assigned to any to-do item.
#{/else}

<script type="text/javascript">

function start_task(id)
  {
	$.post('@{startItem()}' , {id: id});
	alert("Task is now in progress. Good luck!");
	window.location.reload();
  }

function toggle_task(id)
  {
	$.post( '@{toggleItem()}' , {id: id});
  }

</script>