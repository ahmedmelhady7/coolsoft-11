#{extends 'main.html' /}
<br/>
<input type="submit" value="Back to Entity" onclick=location.href="@{MainEntitys.viewEntity(entity.id)}">
<br/>
<br/>
<h3>
    <label>
        View Topic
    </label>
</h3>
<br/>
<div id="crudShow" class="${type.name}">
    <br/>
    <font color="Red">
        ${message}
    </font>
    <br/>
    <div class="objectForm">
        #{form action:@view(object._key()), enctype:'multipart/form-data'}
        <br/>
        #{crud.form fields: ['title', 'creator', 'entity', 'description', 'privacyLevel', 'createRelationship']}
        <br/>
        #{crud.custom 'title'}
        <p>
            <!--<label for="object_title">Title</label>-->
            <label id="object_title" cols="30" rows="1" class="" name="object.title">
                ${object.title}
            </label>
        </p>
        #{/crud.custom}
        <br/>
        <br/>
        #{crud.custom 'creator'}
        <p>
            <label for="object_creator">
                by
            </label>
            <label id="object_creator" cols="30" rows="1" class="" name="object.privacyLevel">
                ${object.creator}
            </label>
        </p>
        #{/crud.custom }
        <br/>
        <br/>
        #{crud.custom 'entity'}
        <p>
            <label for="object_entity">
                in
            </label>
            <label id="object_entity" cols="30" rows="1" class="" name="object.privacyLevel">
                ${object.entity}
            </label>
        </p>
        #{/crud.custom }
        <br/>
        <br/>
        #{crud.custom 'description'}
        <p>
            <label for="object_description">
                Description
            </label>
            <label id="object_description" cols="50" rows="5" class="" name="object.description">
                ${object.description}
            </label>
            <!--<span class="crudHelp" ><font color="Red">*</font>Required</span>-->
        </p>
        #{/crud.custom}
        <br/>
        <br/>
        #{crud.custom 'privacyLevel'}
        <p>
            <label for="object_privacyLevel">
                Privacy Level
            </label>
            #{if object.privacyLevel ==1} 
            <label id="object_privacyLevel" cols="3" rows="1" class="" name="object.privacyLevel">
                private
            </label>
            #{/if}
            #{else}
            <label id="object_privacyLevel" cols="3" rows="1" class="" name="object.privacyLevel">
                public
            </label>
            #{/else}
        </p>
        #{/crud.custom }
		
		#{crud.custom 'createRelationship'}
        <p>
            <label for="object_createRelationship">
                createRelationship
            </label>
            <label id="object_createRelationship" cols="50" rows="5" class="" name="object.createRelationship">
                ${object.createRelationship}
            </label>
            <!--<span class="crudHelp" ><font color="Red">*</font>Required</span>-->
        </p>
        #{/crud.custom}
        #{/crud.form }
        <br/>
        #{if permission == 1}
        <br>
        <button type="submit" onclick= >  Edit
        </button>
        <br>
        #{/if}
        <br/>
        #{if allowed==1}<a href="@{RequestToJoins.viewRequests(1,object.id)}">Requests</a>
		<br>
		<br>
		   <a href="@{Invitations.invite(1,object.id)}">Invite</a>
        #{/if}
        <br>
        <a href="@{Topics.tagTopic(object.id,'@@')}">Add tags</a>
        <br>
        #{/form}<h4>List of ideas within this topic : </h4>
        <div>
        
        #{if numberOfIdeas > 0}
        <form action=@{Ideas.show(ideaId)}>
                #{list items:ideas, as:'idea'}
<!--                &nbsp;-->
                <li>
                <a id = "LOL" href="@{Ideas.show(idea.id)}">${idea.title}</a>
<!--                <INPUT id="hide" type = "button" value = "hide idea" >-->
<!--                <input id ="delete" type="submit" id="delete" value="delete ideas"/>-->
<!--        		<script type ="text/javascript"">-->
<!--        				$('#hide').click(function(){-->
<!--        				alert("HELLO WORLD");-->
<!--        				$('#LOL').hide();-->
<!--        				$('#hide').hide();-->
<!--        				$('#delete').hide();});-->
<!--      		    </script>-->
                </li>
                #{/list}    
        </form>
        #{/if}
        #{if numberOfIdeas == 0}<h4>no ideas posted to this topic</h4>
        #{/if}
        <form action="@{Ideas.blank(topicId)}" method="post">
            <input type="hidden" name"topicId" value="${topicId}"><HR><input type="submit" value="Post Idea to this topic">
        </form>
<!--        #{if canPost == true}-->
<!--        #{/if }-->
#{if permission == 1}
   #{if !hidden}
    #{if deletable}
    <form action="@{delete(object.id)}" method="POST" accept-charset="utf-8" enctype="application/x-www-form-urlencoded" onSubmit="return prompt1();">
        <p class="crudDelete">
        	<input type="hidden" name = "justification" id = "justText">
            <input type="submit" value="&{'crud.delete', type.modelName}" />
        </p>
    </form> #{/if}
    #{if !deletable}
    <form action="@{hide(object.id)}" method="POST" accept-charset="utf-8" enctype="application/x-www-form-urlencoded" onSubmit="return prompt1();">
        <p class="crudDelete">
        	<input type="hidden" name = "justification" id = "justText">
            <input type="submit" value="&{'Hide', type.modelName}" />
        </p>
    </form> #{/if}
    #{/if}
    #{/if}


</div>#{if canClose == 1 && openToEdit == true}
			#{form @Topics.closeTopic(), method:'POST', enctype:'multipart/form-data' }
				<input type = "hidden" name = "topicId" value = ${topicId}>
				<input type="submit" value="Close Topic" />
			#{/form} 
		#{/if} 

		#{if canClose == 1 && openToEdit == false && plan == null}
			#{form @Topics.reopen(), method:'POST', enctype:'multipart/form-data' }
				<input type = "hidden" name = "topicId" value = ${topicId}>
				<input type="submit" value="Reopen Topic" />
			#{/form}
		#{/if}

#{if canPlan == 1 && openToEdit == false && plan == null}
#{form @Plans.planCreate(), method:'POST', enctype:'multipart/form-data' }<input type = "hidden" name = "topicId" value = ${topicIdLong}><input type="submit" value="Create A plan" />#{/form}
#{/if}
#{if openToEdit == false && plan != null}
#{form @Plans.viewAsList(), method:'POST', enctype:'multipart/form-data' }<input type = "hidden" name = "planId" value = ${plan.id}><input type="submit" value="View the plan" />#{/form}
#{/if}
<form action="@{Topics.viewFollowers()}">
    <HR><input type="hidden" name="topicId" value="${targetTopic.id}"><input type="hidden" name="f" value="true">#{if (!targetTopic.followers.contains(user))} 
    <p>
        #{if follower == false} 
        Follow ${targetTopic.title} <input type="submit" value="Follow">#{/if}
        <br/>
        #{/if}
        </form>
        #{if follower == true}
        <p>
            Unfollow ${targetTopic.title} <input type="submit" value="unfollow" onclick="unfollow('${topicId}');"/>
        </p>#{/if}
        </br>
        <form action="@{Topics.viewFollowers()}">
            <input type="hidden" name="topicId" value="${targetTopic.id}"><input type="hidden" name="f" value="false">View ${targetTopic.title} Followers <input type="submit" value="Followers">
           </form>
		    <br/>
            <HR>#{if canNotPost == true}
            <p>
                <a onclick="requestToPost('${topicId}');" href="#">request to post on this topic</a>
            </p>
            #{/if}
            #{if pending == true && canNotPost == false}
            <p>
                Request To Post status: Pending
            </p>
            #{/if}
			<br />
			#{if seeRelationStatus}
			#{if createRelationship}
			<form name="topicForm" action="@{Topics.changeRelationStatus()}" method="POST">
				<input type = "hidden" name = "topicId" value = ${targetTopic.id} >
				<input type="checkbox" id="createRelationship" name="createRelationship" checked>Allow entity to have relationships<br />
				<input type="submit" onclick="get_Value()" value="Change"><br />
				<HR>
			</form>
			#{/if}
			#{else}
			<form name="topicForm" action="@{Topics.changeRelationStatus()}" method="POST">
				<input type = "hidden" name = "topicId" value = ${targetTopic.id} >
				<input type="checkbox" id="createRelationship" name="createRelationship">Allow entity to have relationships
				<input type="submit" onclick="get_Value()" value="Change"><br />
				<HR>
			</form>
			#{/else}
			#{/if}
			<!--#{form @delete(object._key())}
            <p class="crudDelete">
            <input type="submit" value="&{'crud.delete', type.modelName}" />
            </p>
            #{/form}-->
            </div>
            <script type="text/javascript">
                function requestToPost(id, user){
                    $.post('@{addRequest()}', {
                        topicId: id
                    });
                    alert("done!");
                    location.reload(true);
                }
                
                function unfollow(topic, user){
                    $.post('@{Users.unfollowTopic()}', {
                        topicId: topic
                    });
                    alert("done!");
                    location.reload(true);
                }
				function get_Value() {
					var createRelationship = false;
					if(document.topicForm.createRelationship.checked) {
						createRelationship = true;
					}
					return createRelationship;
				}	
				function prompt1(){
					var text = prompt("Why do you want to delete/hide this topic?");
					
					if(text){
						document.getElementById("justText").value=text;
						return true;
					}
					else{
						return false;
					}
					
				}

            </script>
