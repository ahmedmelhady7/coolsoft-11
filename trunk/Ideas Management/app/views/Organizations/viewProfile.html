<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
    <head>
        <meta name="generator" content="HTML Tidy, see www.w3.org">
        <title>Organization Profile View</title>
        <script language="javascript" type="text/javascript" src="/public/javascripts/autocomplete.js">
        </script>
    </head>
    <body>
        #{extends 'Login/index.html' /}		
        #{set title: 'Organization Profile' /}
        <center>
        	#{if org.profilePictureId != -1}
			#{list items:pictureId, as:'id'}
			<img src="@{Pictures.getPicture(id)}" width="75" height="75"/>
			#{/list}
			#{/if}
			#{if org.profilePictureId == -1}
			<img src="/public/images/org.png" width="75" height="75"/>
			#{/if}
			<div style="float: left;">#{if canInvite == true}
                <form onsubmit="help('${org.id}', email.value);" method="post">
                    <input type="hidden" id='users' name="users" value="${usernames}">
					Invite an Idea Developer 
                    <br>Username/Email: <input type="text" id="email" name="email" autoComplete="group"/>
                    <br>Invite by: <input type="radio" id="s" name="select" value="username" checked> Username <input type="radio" name="select" value="email"> E-Mail  <input type="submit" value="Invite"/>
                    <script language="javascript" type="text/javascript">
                        var a = document.getElementById('users');
                        b = a.value + "";
                        c = b.split("|");
                        autoComplete.Set("group", c);
                    </script>
                </form>#{/if}</div>
            <big>
                <h2><b>${org.name}</b></h2>
            </big>
        </center>
		<div id="leftSidebar">
           <div style="clear: both;">
		   				
		   </div>
		   <li>
		   
		  	<ul>
					#{if admin || creator}
					<li>
						<a href="@{Organizations.deleteOrganization(org.id)}" title="Delete Organization">Delete</a>
					</li>
					<li>
						<a href="@{Organizations.editOrganization(org.id)}" title="Edit Organization">Edit</a>
					</li>
					#{/if}
					
             <li>
           <a id="entityLink" href="#">Entities</a>
			 <div id="entityLinks">
            <ul>
            	#{if entities.size() > 0}
            #{list items:entities, as:'entity'}
            <LI type="disc">
            	#{if (entitiesICanView.contains(entity))}
                <a href="@{MainEntitys.viewEntity(entity.id)}">${entity.name}</a>
                #{/if}
                #{else}
                ${entity.name}
                #{/else}
            </LI>
            #{/list}
            #{/if}
            #{else}
            <LI type="disc">No Entities Yet!</LI>
            #{/else}
        </ul>
       </div>
       </li>
       
       #{if (canCreateEntity == 1)}
       <li>
        <a href="@{MainEntitys.goToCreateEntity(org.id)}">Create an Entity</a>
        </li>
        #{/if}
		
		#{if allowed==1}
		<li>
		<a href="@{RequestToJoins.viewRequests(0,org.id)}">Requests</a>
		</li>
        #{/if}
		#{if isMember == true || org.privacyLevel == 2 || admin}
<li>
		<a href="@{Pictures.index(org.id)}">Gallery</a></li>
				#{/if}
		#{if plans.size()>0}
        <li>
           <a id="planLink" style="cursor:pointer;">Plans</a>
			 <div id="plansLinks">
            <ul>
            	#{list items:plans, as:'plan'}
				<li>
				     <a href="@{Plans.viewAsList(plan.id)}">${plan.title}</a>
                </li>
				#{/list}
			</ul>
			</div>
		</li>
		#{/if}
<li>
		<a id="docLink" href="#">Documents</a>
<div id="documen">
	<ul>
	#{if creator == true || admin == true}
	<li><a href="@{Documents.newDocument(org.id)}">Add new</a></li>
	#{/if}
	#{if isMember == true || org.privacyLevel == 2 || admin}
#{ifnot org.getDocuments()}
<li>No documents</li>
#{/ifnot}
    #{list items:org.getDocuments(), as:'document'}
    <li>
    	<a href="@{Documents.viewDocument(document.id)}">${document.name}</a>
	</li>
	#{/list}
	#{/if}#{else}
	<li>No public documents</li>
	#{/else}
	</ul>
</div>
</li>
        <li>
        	#{if (admin || creator)}<a href="@{Tags.createTag(org.id)}" title="Create a new Tag">Create a Tag</a>
        #{/if}
        #{else}
        #{if (org.createTag) && (!join)}<a href="@{Tags.createTag(org.id)}" title="Create a new Tag">Create a Tag</a>
        #{/if}
        #{/else}
        </li>
		
		#{if follower == true}
        <li><a href="#" onclick="unfollow('${org.id}');">Unfollow ${org.name}</a></li>
		#{/if}
		#{else}
		<li><a href="@{followOrganization(org.id)}">Follow ${org.name}</a></li>
		#{/else}
		
		
        <li>
           <a id="followersLink" href="#">Followers</a>
			 <div id="followersLinks">
            <ul>
            	#{if org.followers.size()>0}
            	#{list items:followers, as:'follower'}
				<li>
				     <a href="@{Users.viewProfile(follower.id)}">${follower.firstName} ${follower.lastName}</a>
                </li>
				#{/list}
				#{/if}
				#{else}
				<LI type="disc">No Followers Yet!</LI>
				#{/else}
			</ul>
			</div>
		</li>
		
		
		
		</ul>
		</li>		
		</div>	
		
<script type="text/javascript">
	var bdocs = false;
	$('#documen').hide();	
	 $('#docLink').click(function(){
            if (bdocs) {
                $('#documen').show(500);
                bdocs = false;
            }
            else {
                $('#documen').hide(500);
                bdocs = true;
            }
        });
	        
			var planFlag = true;
        $('#plansLinks').hide();
        $('#planLink').click(function(){
            if (planFlag) {
                $('#plansLinks').show(500);
                planFlag = false;
            }
            else {
                $('#plansLinks').hide(500);
                planFlag = true;
            }
        });
        
        var followerFlag = false;
        $('#followersLinks').hide();
        $('#followersLink').click(function(){
            if (followerFlag) {
                $('#followersLinks').show(500);
                followerFlag = false;
            }
            else {
                $('#followersLinks').hide(500);
                followerFlag = true;
            }
        });
        
        var entityFlag = false;
        $('#entityLinks').hide();
        $('#entityLink').click(function(){
            if (entityFlag) {
                $('#entityLinks').show(500);
                entityFlag = false;
            }
            else {
                $('#entityLinks').hide(500);
                entityFlag = true;
            }
        });

	</script>		
			<div id="page">
        #{if join}
        <form action="@{Organizations.join()}" method="post">
            <input type="hidden" id="organizationId" name="organizationId" value="${org.id}" />Join Organization 
            <p>
                <input type="submit" value="Join" />
            </p>
        </form>#{/if}
        <br>
        <br>
        
		
		#{if logFlag == 1}		
 <input type="submit" value="View Logs" onclick=location.href="@{Logs.viewLogs(org.id)}">
		#{/if}	
<br>
        <br>
        #{if settings==1}
     <a href="@{CreateRelationshipRequests.viewRequests(org.id)}">Relationship Requests</a>
        #{/if}
        <br>
        <br>
        #{if (requestToJoin == true) && (!admin) && (!alreadyRequested)}
        <form action="@{RequestToJoins.requestToJoinOrganization()}" method="post">
            <input type="hidden" id="orgId" name="orgId" value="${org.id}">Your message: 
            <textarea id="description" name="description" rows="5" cols="50">
            </textarea>
            Request to join <input type="submit" value="Request">
            <br/>
            <br/>
            <br/>
            <br/>
        </form>
        #{/if}
        #{else}
        #{if alreadyRequested}
        <big>
            <b>Your request has already been sent!!</b>
        </big>
        #{/if}
        #{else}
        <!--#{if (admin || creator)}<a href="@{Tags.createTag(org.id)}">Create a Tag</a>
        #{/if}
        #{else}
        #{if (org.createTag) && (!join)}<a href="@{Tags.createTag(org.id)}">Create a Tag</a>
        #{/if}
        #{/else}-->
        
        <br/>
        <br/>
         
        	<br/>
        <!--List of entities:
        <ul style="list-style: none;">
            #{list items:entities, as:'entity'}
            <li>
            	#{if (entitiesICanView.contains(entity))}
                <a href="@{MainEntitys.viewEntity(entity.id)}">${entity.name}</a>
                #{/if}
                #{else}
                ${entity.name}
                #{/else}
            </li>
            #{/list}
        </ul>-->
        
        <br/>
        <br>
        List of viewable Tags:
        <ul style="list-style: none;">
            #{list items:tags, as:'tag'}
            <li>
                <a href="@{Tags.mainPage(tag.id)}">${tag.name}</a>
            </li>
            #{/list}
        </ul>
        #{/else}
        #{/else}
        #{if flag == 1}
         
        <form action="@{BannedUsers.restrictOrganizer()}">
            <input type="hidden" name="orgId" value='${org.id}'>
            Restrict / De-Restrict organizers in this organization: <input type="submit" value="view">
        </form>
         <br />
         <form action="@{BannedUsers.restrictGroupInSelectedEntity()}">
            <input type="hidden" name="organizationID" value='${org.id}'>
            Restrict Group of organizers in a certain Entity or Topic : <input type="submit" value="view">
        </form>
        <br />
        <form action="@{BannedUsers.viewRestrictedOrganizersInOrganization()}">
            <input type="hidden" name="organizationID" value='${org.id}'>
            View Restricted Organizers in Entities: <input type="submit" value="view">
        </form>
        <br />
        <form action="@{BannedUsers.viewRestrictedOrganizersTopicPath()}">
            <input type="hidden" name="organizationID" value='${org.id}'>
            View Restricted Organizers in Topics: <input type="submit" value="view">
        </form>
         
        #{/if}
        <!--     </body> -->
        <!-- </html> -->
        <!-- <script type="text/javascript"> -->
        <!-- function test(){ -->
        <!-- 	//var v = document.getElementById('selec').selectedIndex; -->
        <!-- 	var a = document.getElementById('selec').value; -->
        <!-- 	//alert("function" +  a); -->
        <!-- 	if(a!='Tags') -->
        <!-- 	if(a == 0){ -->
        <!-- 		//alert("function2" +  ${org.id}); -->
        <!-- 	$.post('@{Organizations.enableTags()}',{id:${org.id}}); -->
        <!-- 		alert("Options is enabled"); -->
        <!-- 	} -->
        <!-- 	else{ -->
        <!-- 		//alert("function2" +  ${org.id}); -->
        <!-- 	$.post('@{Organizations.disableTags()}',{id:${org.id}}); -->
        <!-- 		alert("Options is disabled"); -->
        <!-- 	} -->
        <!-- 	} -->
        <!-- </script> -->
        <!-- ======= -->
       <!--<form action="@{Organizations.viewFollowers()}">
             <input type="hidden" name="organizationId" value="${org.id}"><input type="hidden" name="flag" value="true">#{if (!org.followers.contains(user))}
            <p>
                Follow ${org.name} <input type="submit" value="Follow">
                <br/>
                #{/if}
                </form> 
                <form action="@{Organizations.viewFollowers()}">
                    <input type="hidden" name="organizationId" value="${org.id}"><input type="hidden" name="flag" value="false">View ${org.name} Followers <input type="submit" value="Followers">
                    <br/>
                     
                </form> -->
				
				#{if (admin || creator)}
				<h4>Create Relationship between <select id="relType" onchange="showRelationForm()">
						<option>select object</option>
						<option>Entities</option>
						<option>Topics</option>
						<option>Tags</option>
					</select> :</h4>
					name: <select id="rels"> 
					<option>choose name</option>
					#{list items:org.relationNames, as:'relName'}
					<option>${relName}</option>
					#{/list}
					</select> <input id="rTextForm" type="text" /> <input type="button" value="add new name" onclick="addName()" /><span id="duplicate"></span>
				
				<p><form id="eform" style="display: none;">
					
					Source: <select id="ent1">
					<option>Select Entity</option>
					#{list items:entitiesCanBeRelated, as:'entityElement'}
					<option value="${entityElement.id}">${entityElement.name}</option>
					#{/list}
					</select>		
					
					Destination: <select id="ent2">
					<option>Select Entity</option>
					#{list items:entitiesCanBeRelated, as:'entityElement'}
					<option value="${entityElement.id}">${entityElement.name}</option>
					#{/list}
					</select>			
					
					<input type="button" value="Create Relation" onclick="createERelation()"/>
					
				</form></p>
				<p>
				<form id="tform" style="display: none;">
										
					Source: <select id="tpc1"> 
					<option>Select Topic</option>
					#{list items:topics, as:'topicElement'}
					<option value="${topicElement.id}">${topicElement.title}</option>
					#{/list}
					</select>
					
					Destination: <select id="tpc2"> 
					<option>Select Topic</option>
					#{list items:topics, as:'topicElement'}
					<option value="${topicElement.id}">${topicElement.title}</option>
					#{/list}
					</select>
					
					<input type="button" value="Create Relation" onclick="createTRelation()" />
					
				</form></p>
				
				
			<p>	<form id="gform" style="display: none;">
										
					Source: <select id="tg1"> 
					<option>Select Tag</option>
					#{list items:tags, as:'tagElement'}
					<option value="${tagElement.id}">${tagElement.name}</option>
					#{/list}
					</select>

					Destination: <select id="tg2"> 
					<option>Select Tag</option>
					#{list items:tags, as:'tagElement'}
					<option value="${tagElement.id}">${tagElement.name}</option>
					#{/list}
					</select>

					<input type="button" value="Create Relation" onclick="createGRelation()" />				
					
				</form></p>
			
				#{/if}
				
				<HR>
				#{if isMember == true || org.privacyLevel == 2 || admin}
                <form action="@{Contribution.contribution()}" method="post">
                    <input type="hidden" name="id" value="${org.id}">Contribution Points: <input type="submit" value="View">
                </form>
				#{/if}
				<HR>
</div>            </body>
            </html>
            <script type="text/javascript">
            	
				function createERelation(){
					var n = document.getElementById("rels").value;
					var s = document.getElementById("ent1").value;
					var d = document.getElementById("ent2").value;
					
					if (n == "choose name" || s == "Select Entity" || d == "Select Entity") {
						alert("Please fill the required filed(s)");
					}else if (s == d){
						alert("Cannot relate entity to itself!");
					}else {
						$.post('@{EntityRelationships.createRelationship()}', {
							name: n,
							sourceId: s,
							destinationId: d
						}, function(data){
							if(data == "true"){
								alert("you have created relation: " + n);
								location.reload();
							}else if(data == "false"){
								alert("relation already exists!!");
							}
						});
					}
				}
				
				function createTRelation(){
					var n = document.getElementById("rels").value;
					var s = document.getElementById("tpc1").value;
					var d = document.getElementById("tpc2").value;
					
					if (n == "choose name" || s == "Select Topic" || d == "Select Topic") {
						alert("Please fill the required filed(s)");
					}else if (s == d){
						alert("Cannot relate topic to itself!");
					}else {
						$.post('@{TopicRelationships.createRelationship()}', {
							name: n,
							sourceId: s,
							destinationId: d
						}, function(data){
							if (data == "true") {
								alert("you have created relation: " + n);
								location.reload();
							}
							else 
								if (data == "false") {
									alert("relation already exists!!");
							}
						});
					}
				}
				
				function createGRelation(){
					var n = document.getElementById("rels").value;
					var s = document.getElementById("tg1").value;
					var d = document.getElementById("tg2").value;
					
					if (n == "choose name" || s == "Select Tag" || d == "Select Tag") {
						alert("Please fill the required filed(s)");
					}else if (s == d){
						alert("Cannot relate tag to itself!");
					}else {
						$.post('@{TagRelationships.createRelationship()}', {
							name: n,
							sourceId: s,
							destinationId: d
						}, function(data){
							if (data == "true") {
								alert("you have created relation: " + n);
								location.reload();
							}
							else 
								if (data == "false") {
									alert("relation already exists!!");
							}
						});
					}
				}
				
				
				function showRelationForm(){
					var txt = document.getElementById('relType').value;
					if(txt == "Entities"){
						$('#tform').hide();
						$('#gform').hide();
						$('#eform').slideToggle();
					}else if(txt == "Topics"){
						$('#eform').hide();
						$('#gform').hide();
						$('#tform').slideToggle();
					}else if(txt == "Tags"){
						$('#eform').hide();
						$('#tform').hide();
						$('#gform').slideToggle();
					}else{
						$('#eform').hide();
						$('#tform').hide();
						$('#gform').hide();
					}
				}
				
				function addName(){
					var strg = document.getElementById('rTextForm').value;
					if (strg != "") {
						$.post('@{Organizations.addRelationName()}',{organizationId:${org.id}, name:strg},
						function(data){
							if (data == "false") {
							document.getElementById('duplicate').textContent="";
							var option = document.createElement("option");
							option.textContent = strg;
							document.getElementById('rels').options.add(option);
							document.getElementById('rTextForm').value = "";
						}
						else if(data == "true"){
							document.getElementById('duplicate').textContent=" Duplicate!!";
						}
						});
					}else{
						alert("enter a name!");
					}
				}
				
				
                                function echeck(str) {
                                
                                		var at="@"
                                		var dot="."
                                		var lat=str.indexOf(at)
                                		var lstr=str.length
                                		var ldot=str.indexOf(dot)
                                		if (str.indexOf(at)==-1){
                                		   alert("Invalid E-mail ID")
                                		   return false
                                		}
                                
                                		if (str.indexOf(at)==-1 || str.indexOf(at)==0 || str.indexOf(at)==lstr){
                                		   alert("Invalid E-mail ID")
                                		   return false
                                		}
                                
                                		if (str.indexOf(dot)==-1 || str.indexOf(dot)==0 || str.indexOf(dot)==lstr){
                                		    alert("Invalid E-mail ID")
                                		    return false
                                		}
                                
                                		 if (str.indexOf(at,(lat+1))!=-1){
                                		    alert("Invalid E-mail ID")
                                		    return false
                                		 }
                                
                                		 if (str.substring(lat-1,lat)==dot || str.substring(lat+1,lat+2)==dot){
                                		    alert("Invalid E-mail ID")
                                		    return false
                                		 }
                                
                                		 if (str.indexOf(dot,(lat+2))==-1){
                                		    alert("Invalid E-mail ID")
                                		    return false
                                		 }
                                		
                                		 if (str.indexOf(" ")!=-1){
                                		    alert("Invalid E-mail ID")
                                		    return false
                                		 }
                                
                                 		 return true				
                                	}
                                
                                function ValidateForm(){
                                	var emailID=document.getElementById("email");
                                	
                                	if ((emailID.value==null)||(emailID.value=="")){
                                		alert("Please Enter your Email ID")
                                		emailID.focus()
                                		return false
                                	}
                                	if (echeck(emailID.value)==false){
                                		emailID.value=""
                                		emailID.focus()
                                		return false
                                	}
                                	return true
                                 }
                                            function test(){
                                            //var v = document.getElementById('selec').selectedIndex;
                                            var a = document.getElementById('selec').value;
                                            //alert("function" +  a);
                                            if(a!='Tags')
                                            if(a == 0){
                                            //alert("function2" +  ${org.id});
                                            $.post('@{Organizations.enableTags()}',{id:${org.id}});
                                            alert("Options is enabled");
                                		  location.reload(true);
                                		
                                            }
                                            else{
                                            //alert("function2" +  ${org.id});
                                            $.post('@{Organizations.disableTags()}',{id:${org.id}});
                                            alert("Options is disabled");
                                			  location.reload(true);
                                            }
                                				
                                            }
                                		function unfollow(id){
                                		$.post('@{Users.unfollowOrganization()}', {
                                			organizationId: id
                                		});
                                		alert("done");
                                		location.reload(true);
                                	}
                                    function help(id, e){
                                		s = document.getElementById("s").checked;
                                        if (!s) {
                                           if(ValidateForm()) {
                                		   	send(id, e, true);
                                		   }
                                			} else {
                                				if (username()) {
                                				send(id, e, false);
                                				}
                                			}
                                    }
                                	function send(id, e, b) {
                                		$.post('@{Organizations.sendInvitation()}', {
                                			organizationId:id,
                                			email:e,
                                			byMail:b
                                		});
										alert("invitation sent");
                                		document.getElementById("email").value = "Invitation has been sent";
                                	}
                                	function username() {
                                		var name = document.getElementById("email").value;
                                		var a = document.getElementById('users');
                                				b = a.value + "";
                                    			c = b.split("|");
                                				for (var i = 0; i < c.length; i++) {
                                				if (c[i] == name) {
                                				return true;
                                				}
                                				}
                                				alert("User with this username does not exist");
                                			return false;
                                			}
                                            
                            
            </script>
