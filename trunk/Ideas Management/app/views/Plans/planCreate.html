#{extends 'main.html' /}
#{set title:'Plan Creation' /}
<h1> Create Plan </h1>
#{form @Plans.myCreate(), method:'POST', id:'plancreationForm', onsubmit: 'return checkall()' enctype:'multipart/form-data' }
Plan title:<input type= "text" id = "title" name = "title" size= "30"><label id = "titleerror"> </label>
</br>
Start Date:<input type = "text" id = "startDate" name = "startDate" size ="30" onblur= "checkdate(this)"><label id = "starterror"> </label>
</br>
End Date:<input type = "text" id = "endDate" name = "endDate"size ="30" onblur= "checkdate(this)"><label id = "enderror"> </label>
</br>
<p><b>Insert the description of the plan</b></p>
</br>
<input type = "hidden" name = "topicId" value = ${topicId} >
<input type = "hidden" name = "ideaString" value = ${ideas} >
<textarea id = "description" name = "description" rows= "7" cols = "50">
</textarea><label id = "descriptionerror"> </label>
</br>
<p><b>Insert the requirements of the plan</b></p>
</br>
<textarea id = "requirement" name = "requirement" rows = "7" cols = "50">
</textarea><label id = "requirementerror"> </label>
</br>
<p><b>Insert an item</b></p>
</br>
Start Date:<input type = "text" id = "istartdate" name = "istartdate" size = "30" onblur= "checkdate(this)"><label id = "istartdateerror"> </label>
</br>
End Date:<input type = "text" id = "ienddate" name = "ienddate" size = "30" onblur= "checkdate(this)"><label id = "ienddateerror"> </label>
</br>
<p><b>Insert the description of the item</b></p>
</br>
<textarea id = "idescription" name = "idescription" rows="7" cols = "50">
</textarea><label id = "idescriptionerror"> </label>
</br>
<p><b>Insert a summary for the description</b></p>
</br>
<input id = "isummary" name = "isummary"type = "text" size = "30"><label id = "isummaryerror"> </label>
</br>
To add another item check here <input type="checkbox" name = "check" value = "checked">
<input type = "submit" value ="Create" >
#{/form}
<textarea id = "datesupported" name = "datesupported" rows="7" cols = "2000">escriptionerror">
The following date formats are accepted:
mm-dd-yyyy, mm/dd/yyyy, mm.dd.yyyy, mm dd yyyy, 
mmm dd yyyy, mmddyyyy, m-d-yyyy, m/d/yyyy, m.d.yyyy, 
m d yyyy, mmm d yyyy, m-d-yy, m/d/yy, m.d.yy, m d yy, 
mmm d yy (yy is 20yy)

(Accepted EU formats just switch month and day)
</textarea>
<script type ="text/javascript">
function checkdate(objName){
	var datefield = objName;
	if (chkdate(objName) == false) {
		datefield.select();
		alert("That date is invalid.  Please try again.");
		datefield.focus();
		return false;
	}
	else {
		return true;
	}
}
function chkdate(objName) {
var strDatestyle = "US"; //United States date style
//var strDatestyle = "EU";  //European date style
var strDate;
var strDateArray;
var strDay;
var strMonth;
var strYear;
var intday;
var intMonth;
var intYear;
var booFound = false;
var datefield = objName;
var strSeparatorArray = new Array("-"," ","/",".");
var intElementNr;
var err = 0;
var strMonthArray = new Array(12);
strMonthArray[0] = "Jan";
strMonthArray[1] = "Feb";
strMonthArray[2] = "Mar";
strMonthArray[3] = "Apr";
strMonthArray[4] = "May";
strMonthArray[5] = "Jun";
strMonthArray[6] = "Jul";
strMonthArray[7] = "Aug";
strMonthArray[8] = "Sep";
strMonthArray[9] = "Oct";
strMonthArray[10] = "Nov";
strMonthArray[11] = "Dec";
strDate = datefield.value;
if (strDate.length < 1) {
return true;
}
for (intElementNr = 0; intElementNr < strSeparatorArray.length; intElementNr++) {
if (strDate.indexOf(strSeparatorArray[intElementNr]) != -1) {
strDateArray = strDate.split(strSeparatorArray[intElementNr]);
if (strDateArray.length != 3) {
err = 1;
return false;
}
else {
strDay = strDateArray[0];
strMonth = strDateArray[1];
strYear = strDateArray[2];
}
booFound = true;
   }
}
if (booFound == false) {
if (strDate.length>5) {
strDay = strDate.substr(0, 2);
strMonth = strDate.substr(2, 2);
strYear = strDate.substr(4);
   }
}
if (strYear.length == 2) {
strYear = '20' + strYear;
}
// US style
if (strDatestyle == "US") {
strTemp = strDay;
strDay = strMonth;
strMonth = strTemp;
}
intday = parseInt(strDay, 10);
if (isNaN(intday)) {
err = 2;
return false;
}
intMonth = parseInt(strMonth, 10);
if (isNaN(intMonth)) {
for (i = 0;i<12;i++) {
if (strMonth.toUpperCase() == strMonthArray[i].toUpperCase()) {
intMonth = i+1;
strMonth = strMonthArray[i];
i = 12;
   }
}
if (isNaN(intMonth)) {
err = 3;
return false;
   }
}
intYear = parseInt(strYear, 10);
if (isNaN(intYear)) {
err = 4;
return false;
}
if (intMonth>12 || intMonth<1) {
err = 5;
return false;
}
if ((intMonth == 1 || intMonth == 3 || intMonth == 5 || intMonth == 7 || intMonth == 8 || intMonth == 10 || intMonth == 12) && (intday > 31 || intday < 1)) {
err = 6;
return false;
}
if ((intMonth == 4 || intMonth == 6 || intMonth == 9 || intMonth == 11) && (intday > 30 || intday < 1)) {
err = 7;
return false;
}
if (intMonth == 2) {
if (intday < 1) {
err = 8;
return false;
}
if (LeapYear(intYear) == true) {
if (intday > 29) {
err = 9;
return false;
}
}
else {
if (intday > 28) {
err = 10;
return false;
}
}
}
if (strDatestyle == "US") {
datefield.value = strMonthArray[intMonth-1] + " " + intday+" " + strYear;
}
else {
datefield.value = intday + " " + strMonthArray[intMonth-1] + " " + strYear;
}
return true;
}
function LeapYear(intYear) {
if (intYear % 100 == 0) {
if (intYear % 400 == 0) { return true; }
}
else {
if ((intYear % 4) == 0) { return true; }
}
return false;
}

	function checkall(){
		var t = document.getElementById("title").value;
		var sd = document.getElementById("startDate").value;
		var ed = document.getElementById("endDate").value;
		var desc = document.getElementById("description").value;
		var req = document.getElementById("requirement").value;
		var isd = document.getElementById("istartdate").value;
		var ied = document.getElementById("ienddate").value;
		var idesc = document.getElementById("idescription").value;
		var isum = document.getElementById("isummary").value;
		var flag = 0;
		if (t == null || t == "") {
			document.getElementById("titleerror").innerHTML = "Please insert a title for your plan";
			flag = 1;
		}
		if (Date.parse(document.getElementById("startDate").value) <= Date.parse(document.getElementById("endDate").value)) {
		
		}
		else {
			if (sd == "" || ed == "") {
				alert("Both start and end dates  must be entered.");
				flag = 1;
			}
			else {
				alert("End Date  must occur after the Start Date.");
				flag = 1;
			}
		}
		if (desc == null || desc == "") {
			document.getElementById("descriptionerror").innerHTML = "Please insert a description";
			flag = 1;
		}
					
		if (req == null || req == "") {
			document.getElementById("requirementerror").innerHTML = "Please insert the requirements";
			flag = 1;
		}
		if (Date.parse(document.getElementById("istartdate").value) <= Date.parse(document.getElementById("ienddate").value)) {
		
		}
		else {
			if (isd == "" || ied == "") {
				alert("Both item start and item end dates  must be entered.");
				flag = 1;
			}
			else {
				alert("Item end Date  must occur after the Item start Date.");
				flag = 1;
			}
		}
		if(Date.parse(document.getElementById("istartdate").value)< Date.parse(document.getElementById("startdate").value)|| Date.parse(document.getElementById("ienddate").value) > Date.parse(document.getElementById("enddate").value)){
			alert("Item dates must be within the plans dates");
			flag = 1;
		}
		if (idesc == null || idesc == ""){
			document.getElementById("idescriptionerror").innerHTML = "Please insert a description";
			flag = 1;
		}
		if (isum == null || isum == ""){
			document.getElementById("isummaryerror").innerHTML = "Please insert summary";
			flag = 1;
		}	
		if(flag == 1){
			return false;
		}
	}
	
</script>

