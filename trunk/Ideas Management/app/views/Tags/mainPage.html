<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html>
    <head>
        <meta name="generator" content="HTML Tidy, see www.w3.org">
		<style type="text/css">
p.padding
{
/*
padding-top:50px;
*/
padding-bottom:25px;
/*
padding-right:50px;
*/
position:absolute;
top:350px;
padding-left:950px;
}
</style>
        <title>Tag Profile View</title>
    </head>

    <body>
        #{extends 'main.html' /}
		#{set title: 'Tag Profile' /}
		#{if flash.success}
		<p style="color:#00ff40">
			${flash.success}
			</p>
		</style>
		#{/if}
		#{if flash.error}
		<p style="color:#ff0000">
			${flash.error}
			</p>
		</style>
		#{/if}
		#{if follower == true}
			 <form onsubmit="unfollow('${tag.id}');" method="post">
			<p>
			Unfollow ${tag.name} <input type="submit" value="unfollow" />
			</p>	
			</form>
		#{/if} 
		#{if follower == false}
			 <form onsubmit="follow('${tag.id}', '${user.id}');" method="post">
			<p>
			Follow ${tag.name} <input type="submit" value="follow" />
			</p>	
			</form>
		#{/if}		 
		#{if allowed}
		<form action="@{Tags.edit()}" method="post">
			<p>
			<input type="hidden" id="tagId" name="tagId" value="${tag.id}" />Edit Tag Name
			<input type="text" id="name" name="name" value="${tag.name}" /> 
                <input class="linkButton" type="submit" value="Edit" />
            </p>
		</form>
		<br />
		<form action="@{Tags.deleteTag()}" method="post">
			<p>
			<input type="hidden" id="tagId" name="tagId" value="${tag.id}" />
			<input class="linkButton" type="submit" value="Delete" />
            </p>
		</form>
		#{/if}
		
		#{if canCreateRelationship == true}
		<p><b>
			<a href="@{Tags.createRelation(tag.id,tag.createdInOrganization.id)}">create relation</a>
		</b></p>
		#{/if}
		
		<script type="text/javascript">
   	function showRename(relId)
	{
	$('#' + relId).hide();
	$('#renameButton_' + relId).hide();
	$('#textToRename_' + relId).show();
	$('#renameDone_' + relId).show();
	}
	
	function actionRename(relId){
		var newRelName = document.getElementById('textToRename_' + relId).value;
		if(newRelName != "" && newRelName != document.getElementById(relId).textContent){
		$.post('@{TagRelationships.renameRelationship()}', {
		relationToBeRenamedId: relId,
		newName: newRelName
	}, function(data){
		if(data == "true"){
			document.getElementById(relId).textContent=newRelName;
				$('#' + relId).show();
				$('#renameButton_' + relId).show();
				$('#textToRename_' + relId).hide();
				$('#renameDone_' + relId).hide();

		}else if(data == "false"){
			alert("Relation already there!");
		}
	});
	}
	else{
		$('#' + relId).show();
				$('#renameButton_' + relId).show();
				$('#textToRename_' + relId).hide();
				$('#renameDone_' + relId).hide();
	}
	}
	
	  	function showRename2(relId)
	{
	$('#' + relId).hide();
	$('#renameButton2_' + relId).hide();
	$('#textToRename2_' + relId).show();
	$('#renameDone2_' + relId).show();
	}
	
	function actionRename2(relId){
		var newRelName = document.getElementById('textToRename2_' + relId).value;
		if(newRelName != "" && newRelName != document.getElementById(relId).textContent){
		$.post('@{TagRelationships.renameRelationship()}', {
		relationToBeRenamedId: relId,
		newName: newRelName
	}, function(data){
		if(data == "true"){
			document.getElementById(relId).textContent=newRelName;
				$('#' + relId).show();
				$('#renameButton2_' + relId).show();
				$('#textToRename2_' + relId).hide();
				$('#renameDone2_' + relId).hide();

		}else if(data == "false"){
			alert("Relation already there!");
		}
	});
	}
	else{
				$('#' + relId).show();
				$('#renameButton2_' + relId).show();
				$('#textToRename2_' + relId).hide();
				$('#renameDone2_' + relId).hide();
	}
	}
   </script>
		
		<a onclick="$('#lista').slideToggle();">Show Relationships</a>
	<div id="lista" style="display:none;">
		#{if tag.relationsSource != null}
		#{list items:tag.relationsSource, as:'relationElement'}
				<ul><a href="/tags/mainpage?tagId=${relationElement.source.id}">${relationElement.source.name}</a> <input id="textToRename_${relationElement.id}" type="text" value=${relationElement.name} style="display:none;"/><q id=${relationElement.id}>${relationElement.name}</q> <a href="/tags/mainpage?tagId=${relationElement.destination.id}">${relationElement.destination.name}</a> #{if canCreateRelationship == true}<input type="button" class="linkButton" value="Done" style="display:none;" id="renameDone_${relationElement.id}" onclick="actionRename(${relationElement.id})"/><input id="renameButton_${relationElement.id}" type="button" class="linkButton" value="edit" onclick="showRename(${relationElement.id})"/> <input type="button" class="linkButton" value="end relationship" onclick="endRelation(${relationElement.id})" />#{/if}</ul>
		#{/list}
		#{/if}
		#{if tag.relationsDestination != null}
		#{list items:tag.relationsDestination, as:'relElement'}
				<ul><a href="/tags/mainpage?tagId=${relElement.source.id}">${relElement.source.name}</a> <input id="textToRename2_${relElement.id}" type="text" value=${relElement.name} style="display:none;"/><q id=${relElement.id}>${relElement.name}</q> <a href="/tags/mainpage?tagId=${relElement.destination.id}">${relElement.destination.name}</a> #{if canCreateRelationship == true}<input type="button" class="linkButton" value="Done" style="display:none;" id="renameDone2_${relElement.id}" onclick="actionRename2(${relElement.id})"/><input id="renameButton2_${relElement.id}" type="button" class="linkButton" value="edit" onclick="showRename2(${relElement.id})"/> <input type="button" class="linkButton" value="end relationship" onclick="endRelation(${relElement.id})" />#{/if}</ul>
		#{/list}
		#{/if}
	</div>
		
        <center><big><b>${tag.name}</b></big></center><br><br>
		List of Followers:
		<br>
		
		#{list items:followers, as:'follower'}
		<li>
			<a href="@{Users.viewProfile(follower.id)}">${follower.username}</a>
		</li>
		#{/list}
		<br>
		List of tagged Topics:
		<br>
		#{list items:topics, as:'topic'}
		<li>
			<a href="@{Topics.show(topic.id)}">${topic.title}</a>
		</li>
		#{/list}
		<br>
		List of tagged Organizations:
		<br>
		#{list items:organizations, as:'organization'}
		<li>
			<a href="@{Organizations.viewProfile(organization.id)}">${organization.name}</a>
		</li>
		#{/list}
		<br>
		List of tagged Entities:
		<br>
		#{list items:entities, as:'entity'}
		<li>
			<a href="@{MainEntitys.viewEntity(entity.id)}">${entity.name} ${entity.organization}</a>
		</li>
		#{/list}
		<br>
		List of tagged Ideas:
		<br>
		#{list items:ideas, as:'idea'}
		<li>
			<a href="@{Ideas.show(idea.id)}">${idea.title}</a>
		</li>
		#{/list}
		
	
	
	<!--	<b>
			<a onclick="@{Users.followTag(tag.id)}" href="/organizations/viewprofile?id=${tag.createdInOrganization.id}">Follow</a>
		</b>
		<script type="text/javascript">
			alert("you are now following " + tag);
		</script>   -->

		<script type="text/javascript">
			
			function endRelation(relId){
				$.post('@{TagRelationships.delete()}', {relationId: relId});
				alert("relation deleted succesfully!");
				window.location.reload();
			}
			
			function unfollow(id){
		$.post('@{Users.unfollowTag()}', {
			tagId: id
		});
		alert("done");
		location.reload(true);
	}
	function follow(id, user){
		$.post('@{Users.followTag()}', {
			tagId: id, userId:user
		});
		alert("done!");
		location.reload(true);
	}
		</script>
		

    </body>
</html>

