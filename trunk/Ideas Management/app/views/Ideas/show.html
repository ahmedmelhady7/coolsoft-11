#{extends 'login/index.html' /}
#{stylesheet src:"ideas.css" /}
<style type="text/css">
	#labels li
	{
		display: inline;
		list-style-type: none;
		padding-right: 20px;
	}
	.div_err{
		color: red;
		display: none;
		text-align: right;
	}
	.div_suc{
		color: green;
		display: none;
		text-align: right;
	}
</style>
<div id="leftSidebar">
  	<br/>
	<br/>
  #{if ideaAlreadyReported==false && canReport && notAuthor}
		  	<br/>
    		<br/>
		    <form action="@{Users.reportIdeaAsSpam()}" method="GET" name="myform">
        		<input type="hidden"  name="ideaId" value="${ideaId}">
                <input id="spam" align="right" type="submit" class="linkButton" value="Report Idea As Spam">
            </form>
          #{/if}
          #{if ideaAlreadyReported==true}
        				<b><font color="Red">you have already reported this idea</font><b>
          #{/if}
   
	<br/>
    #{if notBlockedFromUsing}
    <input type="button" class="linkButton"  id ='share' value="Share idea"/>
	<div id="shareidea">
			<input type="submit" onclick = "share()" class="linkButton"  value="Share with user" /><input type="hidden" name="ideaId" value="${ideaId}">
			
			<select id="userName" name = "userName"> 
					#{list userNames, as:'name'}
					<option>${name}</option>
					#{/list}
					</select>
			<br/>
			<div id = "shareSuccess" class = "div_suc">Notification sent successfully to user</div>
			<script type='text/javascript'>
			function share(){
				
				var userName = document.getElementById('userName').value
				$.post('@{Ideas.shareIdea()}',{userName: userName, ideaId: ${ideaId}},function(){
					document.getElementById('shareSuccess').style.display = 'inline'
				});
				}
			</script>
			</div>		
		</br>
		</br>
		#{/if}
		<font color="#4E4848">Idea rating : ${rate}</font>
		<br/>
		<br/>
 		#{if notBlockedFromUsing}
 		#{if checkPermitted}
 		#{if checkNotRated}
		<input type="button" class="linkButton" id ='rate' value="Rate idea"/>
		
 		<br/>
 		<br/>
		<form action="@{Ideas.rate(ideaId,rat)}" method="GET">
    <input type="submit" value="Submit rating"/><input type = "hidden" name = "ideaId" value = ${ideaId} >
    <select name="rat">
        <option value="0">0</option>
        <option value="1">1</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
        <option value="5">5</option>
    </select>
</form>
		#{/if}
		#{else}
		<font  id='rated'>You have already rated this idea</font>
		<br/>
		<br/>
		#{/else}
		#{/if}	
		#{if notBlockedFromUsing}
		#{if checkPermitted}
		<input type="button" class="linkButton" id ='prior' value="Prioritize idea"/>
		<br/>
		<br/>
		<font color="#4E4848">Idea priority : ${priority}</font>	
		<br/>
		<br/>
		<form id="prioritizeidea" action = @{Ideas.setPriority()} method = "GET">
		<input type = "hidden" name = "ideaId" value = ${ideaId} >
		<br />
		<input type = "radio" name = "priority" value = "critical" checked ="checked"/> critical
		<br />
		<input type = "radio" name = "priority" value = "high"/> high
		<br />
		<input type = "radio" name = "priority" value = "medium"/> medium
		<br />
		<input type = "radio" name = "priority" value = "low"/> low
		<br />
		<input type ="submit" class="linkButton" value = "Submit Priority"/>
		</form>
		#{/if}
		#{/if}
</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<br />
<br />
<a style = "margin-left:3%;" href="@{Topics.show(topic.id)}">Back to ${topic.title}</a>
<br/>
<br/>
<div id="main" class ="post">
<h3>
    <label>
        View idea
    </label>
</h3>
<div>
<div id="labelsContainer">
	<ul id="labels">
	 	#{if ideasLabels.isEmpty()==false}
			<li><font color="#123456">Labels:</font></li>
		#{/if}
		#{list items:ideasLabels, as:'label'}
			<li><a href='@{Labels.showLabel(label.id)}'>${label.name}</a></li>
		#{/list}
	</ul>
</div>
    <font color="Red">
        ${message}
    </font>
    
    </div>
    <div id="main2">
        <p>
            <h2 class="post-title">
            ${object.title}
            	<h3 class"post-metadata">
            	<span class "post-author">
            	#{if active}
            	by <a href="@{Users.viewProfile(userId)}">${username}</a>
            	#{/if}
            	#{if notactive}
            	<font>by ${username}</font>
            	#{/if}
            	</span>
            	<span class "post-tags">

            	</span>
            </h3>
            </h2>
        </p>
        <p>
            
        </p>
        <div class="post-content">
          <div class="about">Detail:</div>
		  <h3>${object.description}</h3>
		  <div class="objectForm">
     #{if isAuthor && notInPlan}
	<form action="@{Topics.deleteIdea(object.id)}" method="POST" accept-charset="utf-8" enctype="application/x-www-form-urlencoded">
			<input type="image" style="float:right;" src="/public/images/icons/trash.png"  class="linkButton" title="Delete My Idea" />
	</form>
	#{/if}
	#{if canDelete && !isAuthor && notInPlan}
		<form action="@{Topics.deleteIdea(object.id)}" method="POST" accept-charset="utf-8" enctype="application/x-www-form-urlencoded" onSubmit="return prompt1();">
        	<input type="hidden" name = "justification" id = "justText">
            <input type="image" style="float:right;" src="/public/images/icons/trash.png"  class="linkButton" title="Delete Idea"/>
    </form>
	#{/if}
	#{if canDelete && !isAuthor && notInPlan}
	<form action="@{Topics.hideIdea(object.id)}" method="POST" accept-charset="utf-8" enctype="application/x-www-form-urlencoded" onSubmit="return prompt1();">
        	<input type="hidden" name = "justification" id = "justText2">
            <input type="submit" style="float:right;" class="linkButton" style="color: red;"  value="&{'Hide Idea', type.modelName}" />
    </form>
    #{/if}
	<br />
  <br />
  </div>
  
        </div>    
    
	<form action="@{Ideas.tagIdea()}" method="post">
        	<input type="hidden" value=${ideaId} name='ideaId'>
			<input type="hidden" value='@@' name='tag'>
			<input type="image" class="linkButton"  title="Add tags" src="/public/images/icons/tag.png">
    </form>
		 <br />
		 <input type="image"  class="linkButton" src="/public/images/icons/good.png" id ='like' title="Like" onclick="like()" />
	   <input type="image"  class="linkButton" src="/public/images/icons/bad.png" id ='dislike' title="Dislike" onclick="disLike()" />
			
        <div class="comment">
 		#{if comments} 
 			<font color="black">Comments</font> 
 			<br/> 
 					 <ul id="commentsList" style="list-style: none; ">
 					#{list comments, as:'comment'} 
 					<div class="comment-metadata">
						<span class="comment-author">by ${comment.commenter.username}</span>
						<span class="comment-date">${comment.commentDate}</span>
					</div>
 					<div class="comment-content">
 						<div class="about">Detail:</div>
 						<li><a>${comment.comment}</a></li>
 						#{if comment.commenter.username != user.username && !comment.reported(user.id)}
 						<form action="@{Users.reportCommentAsSpam()}" method="GET" name="myform">
 						<input type = "hidden" name = "commentId" value = ${comment.id} />
 						<input style="float: right;" type="image" src="/public/images/icons/red_flag.png" />
 						</form>
 						#{/if}
						<br />
 					</div>
 					#{/list} 
 					</ul>
 					<br/>
 		#{/if} 
 		#{else}No comments posted#{/else}
 		</div>

			<div id="comment-content"><textarea name = "comment" id= "commentTxt" rows="7" cols="80"></textarea></div>
			<br/>
			<input class = "linkButton" style = "margin-left: 17%; float: right;" type = "button" value = "Comment" onclick="comment(${ideaId});" >
<br/>
<br/>
 		</div>
            <script type="text/javascript">
			  function comment(id) {
				  	var text = $('#commentTxt').val();
					 $('#commentTxt').val("");
					$.getJSON('@{addCommentToIdea()}', {ideaID:id, comment: text}, function(comm) {
						 $("#commentsList").append("<div class=\"comment-metadata\"><span class=\"comment-author\">by " +  comm.commentUser + "</span><span class=\"comment-date\">" + comm.commentDate + "</span></div><div class=\"comment-content\"><div class=\"about\">Detail:</div><li><a>" + text + "</a></li></div>");
					});
				   

				  }
            	function prompt1(){
					var text = prompt("Why do you want to delete/hide this idea?");
					
					if(text){
						document.getElementById("justText").value=text;
						document.getElementById("justText2").value=text;
						return true;
					}
					else{
						return false;
					}
					
				}
            	$('#share').click(function(){
                	$('#shareidea').toggle();});
            	$('#rate').click(function(){
                	$('#rateidea').toggle();
                	$('#rated').toggle();});
            	$('#prior').click(function(){
                	$('#prioritizeidea').toggle();});
            	
            </script>
			<style type="text/css">
					#shareidea{display: none;}
			</style>
			<style type="text/css">
					#rateidea{display: none;}
			</style>
			<style type="text/css">
					#prioritizeidea{display: none;}
			</style>
			             
	<div>
		
				<script type='text/javascript'>
			;
			function like(){
				$.post('@{Ideas.like}',{ideaId: ${ideaId}},function(){
					alert("you liked this idea");
					document.getElementById('like').disabled = true;
					document.getElementById('dislike').disabled = true;
				});
				}
				;
			function disLike(){
				$.post('@{Ideas.disLike}',{ideaId: ${ideaId}},function(){
					alert("you disliked this idea");
					document.getElementById('like').disabled = true;
					document.getElementById('dislike').disabled = true;
				});
			}
		</script>
 		<div >
		<div id="comment-content"><textarea id="comments1" name = "comment" cols="65" style="float:left;"></textarea><input type="image" src="/public/images/icons/cloud_comment.png"  title = "Comment" onclick="comment1()" /></div>
			</div>
			<br/>
			<div id="commentError" class = "div_err">Comment is empty, please re-enter a valid comment</div>
			<br />
			<div id="commentSuccess" class = "div_suc">Comment posted, refresh to see your comment</div>
      	 	<input type = "hidden" name = "ideaID" value = ${ideaId} />
			
		
		<script type='text/javascript'>
		function comment1(){
			var comment = document.getElementById('comments1').value
			if(comment == '')
			{
				document.getElementById('commentError').style.display = 'inline'
			}
			else
			{
				document.getElementById('commentError').style.display = 'none'
				document.getElementById('commentSuccess').style.display = 'inline'
				$.post('@{Comments.addCommentToIdea()}',{ideaID: ${ideaId}, comment:comment},function(){});	
			;}
			}
		</script>
		<br/>
		#{/if}
		<br/>
		<br/>
		<div id='div1' align='left' style="display: none"></div>
		<br/>
		<form>
			#{if idea.duplicateIdeas}
			<big><b><font color="#4E4848">List Of Duplicates</font></b></big>
			#{list items:idea.duplicateIdeas , as:'idea'}
			<li>
				<a href='@{Ideas.show(idea.id)}' ><b><font color="#4E4848">${idea.title}</font></b></a>
			</li>
			#{/list}
			#{/if}
		</form>
		<br/>
		<br/>
		<br/>
		<br/>
		<br/>
		<br/>
		<br/>
		<br/>
		</div>
        </br>
        </div>
</div>
</div>    
</div>