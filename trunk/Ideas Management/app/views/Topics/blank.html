#{extends 'main.html' /}

<div id="crudBlank" class="${type.name}">
	
	<br />
	
	<h2 id="crudBlankTitle">&{'crud.blank.title', type.modelName}</h2>
	
	<font color="Red">${message}</font>	
	
	<div class="objectForm">
	#{form action:@create(entityId), enctype:'multipart/form-data'}
	#{crud.form fields: ['title', 'description', 'privacyLevel', 'createRelationship']}
		
			#{crud.custom 'title'}
	  		<p> 
 			<label for="object_title">Title</label> 
			<textarea id="object_title" cols="30" rows="1" class="" name="object.title" required></textarea> 
 			<span class="crudHelp" ><font color="Red">*</font>Required</span>
			</p> 
			#{/crud.custom}
		
			#{crud.custom 'description'}
			<p> 
 			<label for="object_description">Description</label> 
			<textarea id="object_description" cols="50" rows="5" class="" name="object.description" required></textarea> 
			<span class="crudHelp" ><font color="Red">*</font>Required</span> 
 			</p> 
			#{/crud.custom}
			
			#{crud.custom 'privacyLevel'}
			<p> 
 			<label for="object_privacyLevel">Privacy Level</label> 
			<select name="object.privacyLevel" id="object_privacyLevel">
 				<option value = "1">private</option>
				<option value = "2">public</option>
 			</select>
 			<span class="crudHelp" ><font color="Red">*</font>Required</span> 
			</p> 
			#{/crud.custom } 
			
			#{crud.custom 'createRelationship'}
			<p> 
 			<label for="object_createRelationship">Allow this topic to have relationships</label> 
			<input type="checkbox" id="object_createRelationship" name="object.createRelationship"> 
			</p> 
			#{/crud.custom } 
		
		#{/crud.form }
		<p class="crudButtons">
			<input id = "save" type="submit" name="_save" value="&{'crud.save', type.modelName}" />
			<input type="submit" name="_saveAndContinue" value="&{'crud.saveAndContinue', type.modelName}" />
			<input type="submit" name="_saveAndAddAnother" value="&{'crud.saveAndAddAnother', type.modelName}" />
		</p>
	#{/form}
			
			<input type="submit" id ="saveAsDraftButton" value="Save as Draft" onclick="saveAsDraft()" ></input>
	</div>

</div>

<script type="text/javascript">
				
	function saveAsDraft() {
		
		var entityId = ${entityId};
		var topicTitle = document.getElementById("object_title").value.toString();
		var topicDescription = document.getElementById("object_description").value.toString();
		var privacyLevelString = document.getElementById("object_privacyLevel").value.toString();
		var privacyLevel;
		var createRelationship = document.getElementById("object_createRelationship").checked;
		
		if(topicTitle == "" && topicDescription == "") {
			alert("Nothing to save");
			return;
		}
		
		if(privacyLevelString == "1") {
			privacyLevel = 1;
		} else {
			privacyLevel = 2;
		}
					
		var link = "/mainentitys/viewentity?id="+entityId;
		$.post('@{Topics.createDraft()}' ,{title:topicTitle, description:topicDescription, 
			privacyLevel: privacyLevel, createRelationship: createRelationship,
			entityId:entityId}, function(){window.location.href=link});					
	}
</script>
	
			